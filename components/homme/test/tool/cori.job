#!/bin/tcsh -f
#SBATCH --job-name nhbench
#SBATCH -N 64
#SBATCH -C knl
#SBATCH -q debug
#SBATCH --time=0:30:00
#
#  script to show how to run various HOMME tools
#  
#  1. generate a NE4 GLL topo file from the baroclinic intial condition
#  2. run the GLL topo smoother on the output from tool #1
#  3. interpolate the smoothed GLL topo data from #2 to a lat/lon grid
#  4. create a NE4 bilinear mapping file, interpolate GLL data from #2
#     (output of #3 and #4 should agree to roundoff)  
#  5. generate a ne4np4 "scrip" and "latlon" metadata files
#
# 
set TOOLDIR = `pwd`
set WDIR = ~/scratch2/hommetool
set exe = $WDIR/src/tool/homme_tool


# compile the tool
cd $WDIR
if (! -x $exe ) then
  $TOOLDIR/../../../../cime/scripts/Tools/get_case_env
  cmake -C $TOOLDIR/../../cmake/machineFiles/cori-knl.cmake  -DPREQX_PLEV=128  $TOOLDIR/../..
  make -j4 homme_tool
  if ( $status ) then
    echo Error compiling homme_tool. Ensure cmake configured properly.  
    exit
  endif
endif

# dont bother with threading
setenv OMP_NUM_THREADS 1

# interpolate file created above to a lat/lon grid
srun -N $SLURM_NNODES -c 4   $exe <  $TOOLDIR/namelists/interpolate-eam.nl




