<?xml version="1.0"?>

<namelist_defaults>

  <!--
      The following block defines convenience selectors. Case settings
      can be used as selectors, but they are often not covenient due to
      long names or having to process their values through regular expressions
      to get the subpiece you are interested in. The convenience selectors
      allow you to express this logic and capture it with a short name.

      The follow attributes are how one defines a selector
        name     : The name of the selector
        case_env : The case value (thing you can xmlquery)
        regex    : OPTIONAL, how to pick out the piece of the value you are interested in
                   By default, the entire value is grabbed. If the regex does not match
                   the case value, then the selector will evaluate to False.

      Example using the nlev selector
        <partmethod nlev="128">42</partmethod>
        <partmethod nlev="72">420</partmethod>
  -->
  <selectors>
    <selector name="hgrid" case_env="ATM_GRID"/>
    <selector name="dyn" case_env="ATM_DYN_TARGET"/>
    <selector name="nlev" case_env="SCREAM_CMAKE_OPTIONS" regex=".*SCREAM_NUM_VERTICAL_LEV ([0-9]+).*"/>
  </selectors>

  <file name="data/scream_input.yaml" format="yaml">
    <Atmosphere__Driver>
      <Atmosphere__Processes>
        <Number__of__Entries>6</Number__of__Entries>
        <Schedule__Type>Sequential</Schedule__Type>
        <Process__0>
          <Process__Name>Homme</Process__Name>
          <Enable__Output__Fields__Checks>False</Enable__Output__Fields__Checks>
          <Enable__Input__Fields__Checks>False</Enable__Input__Fields__Checks>
          <Grid>Dynamics</Grid>
        </Process__0>
        <Process__1>
          <Process__Name>SHOC</Process__Name>
          <Enable__Output__Fields__Checks>False</Enable__Output__Fields__Checks>
          <Enable__Input__Fields__Checks>False</Enable__Input__Fields__Checks>
          <Grid>Physics GLL</Grid>
        </Process__1>
        <Process__2>
          <Process__Name>CldFraction</Process__Name>
          <Enable__Output__Fields__Checks>False</Enable__Output__Fields__Checks>
          <Enable__Input__Fields__Checks>False</Enable__Input__Fields__Checks>
          <Grid>Physics GLL</Grid>
        </Process__2>
        <Process__3>
          <Process__Name>SPA</Process__Name>
          <Enable__Output__Fields__Checks>False</Enable__Output__Fields__Checks>
          <Enable__Input__Fields__Checks>False</Enable__Input__Fields__Checks>
          <Grid>Physics GLL</Grid>
          <SPA__Remap__File>none</SPA__Remap__File>
          <SPA__Data__File>${DIN_LOC_ROOT}/atm/scream/init/spa_file_unified_and_complete_ne4_scream.nc</SPA__Data__File>
        </Process__3>
        <Process__4>
          <Process__Name>P3</Process__Name>
          <Enable__Output__Fields__Checks>False</Enable__Output__Fields__Checks>
          <Enable__Input__Fields__Checks>False</Enable__Input__Fields__Checks>
          <Grid>Physics GLL</Grid>
        </Process__4>
        <Process__5>
          <Process__Name>RRTMGP</Process__Name>
          <Enable__Output__Fields__Checks>False</Enable__Output__Fields__Checks>
          <Enable__Input__Fields__Checks>False</Enable__Input__Fields__Checks>
          <Grid>Physics GLL</Grid>
          <active_gases>h2o, co2, o3, n2o, co, ch4, o2, n2</active_gases>
          <Orbital__Year>-9999</Orbital__Year>
          <Orbital__Eccentricity>-9999</Orbital__Eccentricity>
          <Orbital__Eccentricity COMPSET=".*SCREAM%AQUA.*">0</Orbital__Eccentricity>
          <Orbital__Obliquity>-9999</Orbital__Obliquity>
          <Orbital__Obliquity COMPSET=".*SCREAM%AQUA.*">0</Orbital__Obliquity>
          <Orbital__MVELP>-9999</Orbital__MVELP>
          <Orbital__MVELP COMPSET=".*SCREAM%AQUA.*">0</Orbital__MVELP>
        </Process__5>
      </Atmosphere__Processes>
      <Time__Stepping>
        <Time__Step>300</Time__Step>
        <Start__Time>12, 30, 0</Start__Time>
        <Start__Date>2000, 2, 1</Start__Date>
        <Number__of__Steps>288</Number__of__Steps>
      </Time__Stepping>
      <Grids__Manager>
        <Type>Dynamics Driven</Type>
        <Reference__Grid>Physics GLL</Reference__Grid>
        <Dynamics__Driven>
          <Dynamics__Namelist__File__Name>./data/namelist.nl</Dynamics__Namelist__File__Name>
        </Dynamics__Driven>
      </Grids__Manager>
      <Initial__Conditions>
        <Physics__GLL>
          <Filename>${DIN_LOC_ROOT}/atm/scream/init/init_ne4np4.nc</Filename>
          <Filename COMPSET=".*SCREAM%AQUA.*">${DIN_LOC_ROOT}/atm/scream/init/scream-aquaplanet_init_ne4np4_L72_20211202.nc</Filename>
          <T_mid_prev>T_mid</T_mid_prev>
          <horiz_winds_prev>horiz_winds</horiz_winds_prev>
          <w_int>0.0</w_int>
          <w_int_prev>0.0</w_int_prev>
        </Physics__GLL>
        <Dynamics>
          <tracers>tracers, Physics GLL</tracers>
        </Dynamics>
      </Initial__Conditions>
      <Scorpio>
        <Output__YAML__Files>data/scream_output.yaml, </Output__YAML__Files>
      </Scorpio>
    </Atmosphere__Driver>
    <SCREAM>
      <Start__Date>${RUN_STARTDATE}</Start__Date>
      <Input__Files>${DIN_LOC_ROOT}/atm/scream/init/rrtmgp-data-sw-g224-2018-12-04.nc, ${DIN_LOC_ROOT}/atm/scream/init/rrtmgp-data-lw-g256-2018-12-04.nc, ${DIN_LOC_ROOT}/atm/scream/init/rrtmgp-cloud-optics-coeffs-sw.nc, ${DIN_LOC_ROOT}/atm/scream/init/rrtmgp-cloud-optics-coeffs-lw.nc, ${DIN_LOC_ROOT}/atm/scream/tables/p3_lookup_table_1.dat-v4.1.1</Input__Files>
    </SCREAM>
  </file>

  <file name="data/namelist.nl" format="nml">
    <ctl_nl>
      <partmethod>4</partmethod>
      <cubed_sphere_map>0</cubed_sphere_map>
      <topology>cube</topology>
      <u_perturb>1</u_perturb>
      <rotate_grid>0</rotate_grid>
      <ne>4</ne>
      <statefreq>9999</statefreq>
      <mesh_file>/dev/null</mesh_file>
      <tstep>300</tstep>
      <nu>3.4e-08</nu>
      <nu_div>-1</nu_div>
      <nu_p>-1</nu_p>
      <nu_q>-1</nu_q>
      <nu_s>-1</nu_s>
      <nu_top>250000.0</nu_top>
      <se_ftype>0</se_ftype>
      <limiter_option>9</limiter_option>
      <vert_remap_q_alg>10</vert_remap_q_alg>
      <hypervis_scaling>3.0</hypervis_scaling>
      <hypervis_order>2</hypervis_order>
      <hypervis_subcycle>1</hypervis_subcycle>
      <hypervis_subcycle_tom>1</hypervis_subcycle_tom>
      <theta_hydrostatic_mode>True</theta_hydrostatic_mode>
      <theta_advect_form>1</theta_advect_form>
      <tstep_type>5</tstep_type>
      <dt_remap_factor>1</dt_remap_factor>
      <dt_tracer_factor>1</dt_tracer_factor>
      <moisture>moist</moisture>
    </ctl_nl>
    <vert_nl>
      <vfile_mid>./data/scream-72m.ascii</vfile_mid>
      <vfile_int>./data/scream-72i.ascii</vfile_int>
    </vert_nl>
  </file>

</namelist_defaults>
